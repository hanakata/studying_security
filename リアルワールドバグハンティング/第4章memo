第4章 クロスサイトリクエストフォージェリ

クロスサイトリクエストフォージェリ(CSRF)攻撃は攻撃者がターゲットのブラウザからHTTPリクエストを他の
Webサイトに送信させるときに生じる。
そしてそのWebサイトはそのリクエストが正当でターゲットによって送信されたかのようにアクションする。
基本的な例は以下
1.Bobが銀行のWebサイトにログインして残高を確認する
2.確認を終えた後、Bobは別のドメインにあるメールアカウントを確認する
3.馴染みのないWebサイトへのリンクを持つメールがBobに届いておりそのリンクをクリックして先を見る
4.馴染みのないサイトがロードされるとBobのブラウザに対してBobの銀行WenサイトへBobの口座から攻撃者への口座へ送金する要求を発行する
5.銀行のサイトから送金が実行される

・認証
CSRF攻撃はリクエストの認証のためにWebサイトが利用するプロセス中の弱点を利用する。
認証情報の保存方法は以下の2つ
1.基本認証プロトコル
2.Cookie
基本認証を使うサイトはヘッダに認証情報を入れて送信している
クッキーはユーザのブラウザに保存

・GetリクエストでのCSRF
銀行サイトがGETリクエストでの送金を受け付けるなら悪意あるサイトはHTTPリクエストか<img>タグで送信できる。
imgタグで実行する方法はsrcに送金用のＵＲＬを埋め込むだけ。

・POSTリクエストでのCSRF
銀行サイトがPOSTリクエストを行うならimgタグは使えない。
ただしiframeタグを利用してスクリプトでPOSTを実行するようには書ける
→攻撃可能

・CSRF攻撃に対する防御
CSRF脆弱性の緩和方法はいくつもある
一般的な保護の1つはCSRFトークン。
保護されたサイトはデータを変更数r可能性があるリクエストの場合、
CSRFトークンを要求する

・Shopify Twitterの切断
潜在的なCSRF脆弱性を探す場合、サーバサイドのデータを変更するGETリクエストに注意する

・ユーザのInstractゾーンの変更
APIのエンドポイントも対象となる

・Badooの完全なアカウントｎ乗っ取り
トークンを奪われる可能性もある

